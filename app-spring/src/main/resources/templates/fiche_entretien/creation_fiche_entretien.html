<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="fr">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<title>CRÉATION FICHE ENTRETIEN</title>
		<link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" rel="stylesheet">
		<link href="https://getbootstrap.com/docs/4.0/examples/signin/signin.css" rel="stylesheet">
	</head>
	-->
	<head th:replace="fragments/header :: taghead"></head>
	<body>
		<div th:replace="fragments/menu :: tagmenu">  </div>
		<div class="container">
			<form class="" th:action="@{/entretien/create}" th:object="${nouvelleFicheEntretien}" method="post">
			<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
				<h2 class="">Création d'une fiche d'entretien</h2>
								  	
				<p>
					<label for="client" class="">Client : </label>
					<select id="client" name="client" th:field="*{client}">
						<option th:each="c : ${clients}" th:text="${c.nom + ' ' + c.prenom}" th:value="${c.id}"></option>
					</select>
				</p>
				
				<p>
					<label for="date" class="">Date de création : </label>
					<input type="date" id="date" name="date" th:value="*{dateCreation}" th:field="*{dateCreation}"/>
				</p>
				
				<hr/>
				
				<h3 th:if="${taches.size()} > 0">Liste des tâches</h3>
				
				<table>
					<tr th:if="${taches.size()} > 0">
						<th>N°</th><th>Intitulé</th><th>Type</th><th>Pièces nécessaires</th><th>Assignation</th><th>Priorité</th><th></th>
					</tr>
					<tr th:each="t : ${taches}">
						<td th:text="${t.id}"></td>
						<td th:text="${t.intitule}"></td>
						<td th:text="${t.getType().name()}"></td>
						<td><span th:each="pn : ${t.piecesNecessaires}"><span th:text="${pn.nomPiece}"></span><br/></span></td>
						<td th:text="${t.mecanicienAttribue.nom + ' ' + t.mecanicienAttribue.prenom}"></td>
						<td th:text="${t.getPriorite().name()}"></td>
						<td>
							<a th:href="@{/entretien/create/modification-tache/{id}(id=${t.id})}">Modifier</a>
							<a>Supprimer</a>
						</td>
					</tr>
				</table>
				
				<a  class="btn btn-warning" th:href="@{/entretien/create/ajout-tache}">Ajouter une tâche</a>
				<button class="btn btn-success" name="enregistrer" value="enregistrer" type="submit">Enregistrer la fiche</button>
				<button class="btn btn-primary" name="valider" value="valider" type="submit">Enregistrer et valider la fiche</button>
				<a class="btn btn-secondary" th:href="@{/entretien/create/abort}">Retour à la maison</a>
			</form>
		</div>
	</body>
</html>